{
  "name": "Session Host",
  "description": "Endpoints required for Azure Virtual Desktop session host VMs",
  "source": "https://learn.microsoft.com/en-us/azure/virtual-desktop/required-fqdn-endpoint",
  "categories": [
    {
      "name": "Authentication",
      "description": "Authentication and identity endpoints",
      "endpoints": [
        {
          "id": "sh-azure-login",
          "name": "Azure AD Authentication",
          "url": "login.microsoftonline.com",
          "port": 443,
          "protocol": "tcp",
          "required": true,
          "purpose": "Authentication to Microsoft Online Services",
          "latencyCritical": true,
          "muted": false
        }
      ]
    },
    {
      "name": "Core AVD Services",
      "description": "Essential endpoints for AVD functionality",
      "endpoints": [
        {
          "id": "sh-avd-services",
          "name": "AVD Services",
          "url": "*.wvd.microsoft.com",
          "port": 443,
          "protocol": "tcp",
          "required": true,
          "purpose": "Service traffic including TCP based RDP connectivity",
          "latencyCritical": true,
          "muted": false,
          "wildcardPattern": "*.wvd.microsoft.com",
          "knownSubdomains": ["rdgateway", "rdweb", "client", "rdbroker"]
        },
        {
          "id": "sh-windows-cloud-service",
          "name": "Windows Cloud Service",
          "url": "global.prod.service.windows.cloud.microsoft.com",
          "port": 443,
          "protocol": "tcp",
          "required": true,
          "purpose": "Service Traffic",
          "latencyCritical": false,
          "muted": false
        }
      ]
    },
    {
      "name": "Agent & Updates",
      "description": "Endpoints for AVD agent updates and Azure services",
      "endpoints": [
        {
          "id": "sh-catalog-artifact",
          "name": "Azure Marketplace",
          "url": "catalogartifact.azureedge.net",
          "port": 443,
          "protocol": "tcp",
          "required": true,
          "purpose": "Azure Marketplace",
          "latencyCritical": false,
          "muted": false
        },
        {
          "id": "sh-agent-blob",
          "name": "Agent Updates (Blob)",
          "url": "mrsglobalsteus2prod.blob.core.windows.net",
          "port": 443,
          "protocol": "tcp",
          "required": true,
          "purpose": "Agent and side-by-side (SXS) stack updates",
          "latencyCritical": false,
          "muted": false
        },
        {
          "id": "sh-portal-blob",
          "name": "Azure Portal Support",
          "url": "wvdportalstorageblob.blob.core.windows.net",
          "port": 443,
          "protocol": "tcp",
          "required": true,
          "purpose": "Azure portal support",
          "latencyCritical": false,
          "muted": false
        }
      ]
    },
    {
      "name": "Monitoring",
      "description": "Endpoints for Azure Monitor and diagnostics",
      "endpoints": [
        {
          "id": "sh-monitor-gcs",
          "name": "Azure Monitor (GCS)",
          "url": "gcs.prod.monitoring.core.windows.net",
          "port": 443,
          "protocol": "tcp",
          "required": true,
          "purpose": "Agent traffic",
          "latencyCritical": false,
          "muted": false
        }
      ]
    },
    {
      "name": "Windows Activation",
      "description": "Endpoints for Windows license activation",
      "endpoints": [
        {
          "id": "sh-kms-activation",
          "name": "Windows KMS Activation",
          "url": "azkms.core.windows.net",
          "port": 1688,
          "protocol": "tcp",
          "required": true,
          "purpose": "Windows activation",
          "latencyCritical": false,
          "muted": false
        }
      ]
    },
    {
      "name": "Certificates",
      "description": "Endpoints for certificate validation and revocation",
      "endpoints": [
        {
          "id": "sh-cert-ocsp",
          "name": "OCSP Certificates",
          "url": "oneocsp.microsoft.com",
          "port": 80,
          "protocol": "http",
          "required": true,
          "purpose": "Certificates",
          "latencyCritical": false,
          "muted": false
        },
        {
          "id": "sh-cert-microsoft",
          "name": "Microsoft Certificates",
          "url": "www.microsoft.com",
          "port": 80,
          "protocol": "http",
          "required": true,
          "purpose": "Certificates",
          "latencyCritical": false,
          "muted": false
        },
        {
          "id": "sh-cert-ctldl",
          "name": "Certificate Trust List",
          "url": "ctldl.windowsupdate.com",
          "port": 80,
          "protocol": "http",
          "required": true,
          "purpose": "Certificates",
          "latencyCritical": false,
          "muted": false
        }
      ]
    },
    {
      "name": "Optional Services",
      "description": "Optional endpoints for additional functionality",
      "endpoints": [
        {
          "id": "sh-azure-imds",
          "name": "Azure Instance Metadata",
          "url": "169.254.169.254",
          "port": 80,
          "protocol": "http",
          "required": false,
          "purpose": "Azure Instance Metadata service endpoint (Azure VMs only)",
          "enabled": false,
          "latencyCritical": false,
          "muted": false
        },
        {
          "id": "sh-azure-health",
          "name": "Session Host Health",
          "url": "168.63.129.16",
          "port": 80,
          "protocol": "http",
          "required": false,
          "purpose": "Session host health monitoring (Azure VMs only)",
          "enabled": false,
          "latencyCritical": false,
          "muted": false
        },
        {
          "id": "sh-connectivity-test",
          "name": "Internet Connectivity Test",
          "url": "www.msftconnecttest.com",
          "port": 80,
          "protocol": "http",
          "required": false,
          "purpose": "Detects if the session host is connected to the internet",
          "latencyCritical": false,
          "muted": false
        }
      ]
    }
  ]
}
